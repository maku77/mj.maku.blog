<!doctype html><html lang=ja-jp><head prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb#"><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>麻雀のシャンテン数を数えるアルゴリズム｜まくまく麻雀ノート</title><script async src="https://www.googletagmanager.com/gtag/js?id=G-MPC341NBMR"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-MPC341NBMR")</script><meta property="og:site_name" content="まくまく麻雀ノート"><meta property="og:title" content="麻雀のシャンテン数を数えるアルゴリズム"><meta property="og:type" content="website"><meta property="og:url" content="https://mj.maku.blog/p/5jrczda/"><meta property="og:locale" content="ja_JP"><meta property="og:image" content="https://mj.maku.blog/img/site-logo.png"><meta property="og:image:width" content="1000"><meta property="og:image:height" content="566"><meta property="og:description" content="プログラムで麻雀のシミュレーションを行うとき、手牌のシャンテン数を数えたいことがあります。 ここでは、機械的にシャンテン数を数えるアルゴリズムを考えてみます。 七対子や国士無双のシャンテン数は簡単に調べられるので、「4 メンツ + 1 雀頭」の基本形でアガる場合のシャンテン数を数える方法を説明します。
基本的な考え方 1m2m3m-5s5s5s-3p4p5p-1z1z1z-7z7z このような形が、4 メンツ + 1 雀頭の基本形です。 この 5 ブロック（合計 14 枚）のアガリ形を作るために、あと何枚の牌が必要かを考えればよいことになります。 ただし、アガリまでの枚数は、聴牌であればあと 1 枚、イーシャンテンであればあと 2 枚なので、シャンテン数を数える場合は、アガリまでの枚数から 1 を引いて数えることに注意してください（アガリまであと 3 枚であれば、2 シャンテンです）。
テンパイまでに必要な枚数ではなく、現在の手牌のうち何枚使えるかを基準にして考えることもできます。 その場合は、13 - アガリ形になったときに今ある手牌のうち何枚使えるか がシャンテン数になります。
最悪のシャンテン数 1m5m9m-1s5s9s-1p4p8p-1z2z3z-5z7z 手牌に 1 つもターツがない、バラバラの状態は何シャンテンでしょうか？ 13 シャンテンでしょうか？ 違いますね。 仮に上記のようにバラバラの手牌であったとしても、少なくとも 5 枚の牌は 5 ブロックの中の 1 枚としてアガリ形の中で使えます。 つまり、最悪のシャンテン数は 8 シャンテン (13 - 5) です。 もちろん、実際には七対子があるので、本当の最大シャンテン数は 6 シャンテンになります。
あとは、8 シャンテンを基準にして、手牌にどのような形が含まれていればシャンテン数が減るのかを調べていけば OK です。
ターツまたはトイツができると 1 歩前進 1m2m9m-1s5s9s-1p4p8p-1z2z3z-7z7z 上記のように、ターツ ( 1m2m ) やトイツ ( 7z7z ) ができると聴牌に向かって 1 歩前進します。 このように 2 枚で構成されるターツあるいはトイツのことを ペア と呼ぶことにします（ペアの例: 1m2m 、3s4s 、7p9p 、4z4z ）。 ペア 1 組ごとにシャンテン数は 1 つ減るので、（ペアだけを考慮した）シャンテン数は次のように計算できます。"><meta property="fb:app_id" content="727481858403810"><link rel=stylesheet href=../../css/main.min.3b8b1efe3c88624bc9e82fa7abdeaba10be4d1b58361067ed98fcb20388716a8.css><link rel=icon sizes="16x16 32x32 48x48 64x64" href=../../assets/favicon/favicon.ico><link rel=icon sizes=192x192 href=../../assets/favicon/192x192.png><link rel=apple-touch-icon href=../../assets/favicon/180x180.png><script src=../../assets/js/ext-links.js defer></script>
<script src=../../assets/js/sidebar.js defer></script><style>.codoc-support{display:inline-block;margin:.5rem 0 0!important;padding:12px!important;width:210px!important;max-width:100%}.codoc-support .codoc-support-title{font-size:smaller!important;white-space:nowrap;margin-bottom:12px!important}.codoc-support .codoc-btn{width:180px!important}</style><script src=https://codoc.jp/js/cms.js data-css=black data-usercode=tp6ZPzTj3w defer></script><style>.xMj img{display:inline-block;height:1.7em;border:solid 1px #333;margin-right:1px;border-radius:3px}.xMj img.horizontal{height:auto;width:1.7em}.xMj>.space{padding-left:.5em}.xMjCenter>.space{padding-left:1em}.xMjCenter{padding:1em 0;display:flex;align-items:flex-end;justify-content:center}.xMjCenter img{min-width:0;max-width:2em;object-fit:contain}.xMjCenter img.horizontal{max-width:2.7em}</style><script>(function(){window.addEventListener("DOMContentLoaded",()=>{const t=document.querySelectorAll(".xMj, .xMjCenter");t.forEach(t=>{t.innerHTML=e(t.innerText)})});function e(e){let n="";try{for(let s of t(e)){if(s==="-"){n+='<span class="space"></span>';continue}let o="";s.endsWith("h")&&(o="horizontal"),n+=`<img class="${o}" alt="${s}" src="../../assets/img/pai/${s}.png">`}}catch(t){return`<b>${e}</b><small style="color:red">（牌変換Error: ${t}）</small>`}return n}function*t(e){let t=0;for(;t<e.length;){const s=e.charAt(t++);if(s==="-"){yield"-";continue}if(!(0<=s&&s<=9))throw`${t}文字目の数値`;const n=e.charAt(t++);if(n!=="m"&&n!=="p"&&n!=="s"&&n!=="z")throw`${t}文字目の牌種`;const o=e.charAt(t);o==="h"?(yield`${s}${n}h`,t+=1):yield`${s}${n}`}}})()</script></head><body><div id=xRoot><div id=xSiteHeader><a href=../../>まくまく麻雀ノート</a></div><aside><div class=xBreadcrumb><span class=xBreadcrumb_item><a href=../../>&#x1F3E0;</a></span>
<span class=xBreadcrumb_item><a href=../../p/nythxwz/>コラム・雑記</a></span>
<span class=xBreadcrumb_item>麻雀のシャンテン数を数えるアルゴリズム</span></div></aside><div id=xContainer><nav id=xMenu aria-label=メニュー><div id=sidebar style=height:100%><div id=sidebar_notFixed><a href=../../><img src=https://mj.maku.blog/img/site-logo-sidebar.png alt=サイトロゴ></a><div class=xMenu_box data-sticky><form action=https://cse.google.com/cse target=_blank><div class=xSearchBox><input type=hidden name=cx value=partner-pub-6317852277883092:5421923271>
<input type=hidden name=ie value=UTF-8>
<input type=search name=q placeholder=サイト内検索 size=30 autocomplete=off>
<input type=submit value=検索></input></div></form><div class=xMenu_box_body></div></div><div class=xMenu_box data-sticky><h3 class=xMenu_box_title><a href=../../latest/>新着</a></h3><div class=xMenu_box_body><div class=xBoxLink><a href=../../p/z5csk9w/>リャンメンカンチャンを残す練習
<time>2023-07-25</time></a></div><div class=xBoxLink><a href=../../p/u9cegbf/>捨て牌読み: 24 カンチャン落としにウラ筋なし
<time>2023-07-15</time></a></div><div class=xBoxLink><a href=../../p/5jrczda/>麻雀のシャンテン数を数えるアルゴリズム
<time>2023-07-02</time></a></div><div class=xBoxLink><a href=../../p/triuood/>麻雀団体のルール比較表
<time>2023-07-01</time></a></div><div class=xBoxLink><a href=../../p/9eu4cjs/>麻雀読書メモ『ムツゴロウ畑正憲の精密麻雀』畑正憲
<time>2023-05-22</time></a></div></div></div><div class=xMenu_box data-sticky><h3 class=xMenu_box_title><a href=../../sitemap/>フォルダ</a></h3><div class=xMenu_box_body><div class=xNavTree><ul><li><a class=xNavTree-dir href=../../p/idvn9nd/>戦略</a><li><a class=xNavTree-dir href=../../p/nythxwz/>コラム・雑記</a><ul></ul><li><a class=xNavTree-dir href=../../p/viwamxa/>麻雀本メモ</a><li><a class=xNavTree-dir href=../../p/hsmg4oa/>ルール</a><li><a class=xNavTree-dir href=../../p/z4u6q5w/>待ち牌</a><li><a class=xNavTree-dir href=../../p/vnyskom/>麻雀ルール質問箱 (Q&amp;A)</a><li><a class=xNavTree-dir href=../../p/yimn977/>間違えやすい点数計算シリーズ</a><li><a href=../../p/ekefsjn/>麻雀用語集</a></ul></div></div></div><div class=xMenu_box data-sticky><h3 class=xMenu_box_title><a href=../../tags/>タグ</a></h3><div class=xMenu_box_body><div id=local-tag-container><div class=xMenu_tag><a href=../../tags/%E6%88%A6%E7%95%A5/>戦略 (40)</a></div><div class=xMenu_tag><a href=../../tags/%E6%8D%A8%E3%81%A6%E7%89%8C%E8%AA%AD%E3%81%BF/>捨て牌読み (15)</a></div><div class=xMenu_tag><a href=../../tags/%E3%82%B3%E3%83%A9%E3%83%A0/>コラム (12)</a></div><div class=xMenu_tag><a href=../../tags/%E7%89%8C%E5%8A%B9%E7%8E%87/>牌効率 (10)</a></div><div class=xMenu_tag><a href=../../tags/%E8%AA%AD%E6%9B%B8/>読書 (10)</a></div><div class=xMenu_tag><a href=../../tags/%E3%83%AB%E3%83%BC%E3%83%AB/>ルール (6)</a></div><div class=xMenu_tag><a href=../../tags/%E4%BD%95%E5%88%87%E3%82%8B/>何切る (4)</a></div><div class=xMenu_tag><a href=../../tags/%E7%82%B9%E6%95%B0%E8%A8%88%E7%AE%97/>点数計算 (3)</a></div><div class=xMenu_tag><a href=../../tags/%E8%B3%AA%E5%95%8F/>質問 (3)</a></div><div class=xMenu_tag><a href=../../tags/%E5%BE%85%E3%81%A1%E7%89%8C/>待ち牌 (1)</a></div><div class=xMenu_tag><a href=../../tags/%E9%9B%80%E9%AC%BC%E6%B5%81/>雀鬼流 (1)</a></div></div><a href=../../tags/ style="display:block;padding:.2em .4em;margin:.3em;font-size:smaller">すべて表示 …</a></div></div><script>const NUM_TAGS=10;function getRandomItemsFromArray(e,t){const n=e.sort(()=>Math.random()-.5);return n.slice(0,t)}const containerElem=document.getElementById("local-tag-container"),tagElems=document.querySelectorAll(".xMenu_tag"),tagArray=Array.from(tagElems),shuffledTags=getRandomItemsFromArray(tagArray,NUM_TAGS);containerElem.innerHTML="",shuffledTags.forEach(e=>containerElem.appendChild(e))</script><div class=xMenu_box data-sticky><br></div></div><div id=sidebar_fixed style=position:-webkit-sticky;position:sticky;top:4rem></div></div></nav><main id=xMain><div id=redirect-notification style=display:none;font-size:smaller;padding:1em>Web サイトの URL が変わりました。ブックマークの変更をお願いします。<br>変更前: <s>https://memoja.net</s><br>変更後: <a href=https://toushi.maku.blog>https://toushi.maku.blog</a><br></div><script>const url=new URL(document.location);if(url.searchParams.get("redirected_from")==="memoja.net"){const e=document.getElementById("redirect-notification");e.style.display="block",url.searchParams.delete("redirected_from"),history.replaceState({},"",url)}</script><article class=xArticle itemscope itemtype=https://schema.org/BlogPosting><aside><div class=xPrevNextLink><div class=xPrevNextLink_next><a href=../../p/3p3eq3e/>人間ドックの日に打ったら</a></div></div></aside><header class=xArticle_headerBox><div><span class=xArticle_headerBox_breadcrumb><a href=../../>&#x1F3E0;</a></span>
<span class=xArticle_headerBox_breadcrumb><a href=../../p/nythxwz/>コラム・雑記</a></span></div><div style=display:flex;margin-top:.8em><div style=flex:1><h1 itemprop=headline class=xArticle_headerBox_title><a itemprop=mainEntityOfPage href=../../p/5jrczda/>麻雀のシャンテン数を数えるアルゴリズム</a></h1></div></div><span class=xPageDate>更新: <time itemprop=dateModified datetime=2023-07-02>2023-07-02</time><br>作成: <time itemprop=datePublished datetime=2023-07-02>2023-07-02</time></span></header><div itemprop=articleBody class=xArticle_content><nav id=TableOfContents><ul><li><a href=#基本的な考え方>基本的な考え方</a></li><li><a href=#最悪のシャンテン数>最悪のシャンテン数</a></li><li><a href=#ターツまたはトイツができると-1-歩前進>ターツまたはトイツができると 1 歩前進</a></li><li><a href=#メンツができると-2-歩前進>メンツができると 2 歩前進</a></li><li><a href=#メンツ数による制約>メンツ数による制約</a></li><li><a href=#メンツターツトイツを数える>メンツ、ターツ、トイツを数える</a></li></ul></nav><p>プログラムで麻雀のシミュレーションを行うとき、手牌のシャンテン数を数えたいことがあります。
ここでは、機械的にシャンテン数を数えるアルゴリズムを考えてみます。
七対子や国士無双のシャンテン数は簡単に調べられるので、「4 メンツ + 1 雀頭」の基本形でアガる場合のシャンテン数を数える方法を説明します。</p><h2 id=基本的な考え方>基本的な考え方</h2><span class=xMjCenter>1m2m3m-5s5s5s-3p4p5p-1z1z1z-7z7z</span><p>このような形が、4 メンツ + 1 雀頭の基本形です。
この 5 ブロック（合計 14 枚）のアガリ形を作るために、あと何枚の牌が必要かを考えればよいことになります。
ただし、アガリまでの枚数は、聴牌であればあと 1 枚、イーシャンテンであればあと 2 枚なので、シャンテン数を数える場合は、アガリまでの枚数から 1 を引いて数えることに注意してください（アガリまであと 3 枚であれば、2 シャンテンです）。</p><p>テンパイまでに必要な枚数ではなく、現在の手牌のうち何枚使えるかを基準にして考えることもできます。
その場合は、<strong>13 - アガリ形になったときに今ある手牌のうち何枚使えるか</strong> がシャンテン数になります。</p><h2 id=最悪のシャンテン数>最悪のシャンテン数</h2><span class=xMjCenter>1m5m9m-1s5s9s-1p4p8p-1z2z3z-5z7z</span><p>手牌に 1 つもターツがない、バラバラの状態は何シャンテンでしょうか？
13 シャンテンでしょうか？
違いますね。
仮に上記のようにバラバラの手牌であったとしても、少なくとも 5 枚の牌は 5 ブロックの中の 1 枚としてアガリ形の中で使えます。
つまり、<strong>最悪のシャンテン数は 8 シャンテン</strong> (13 - 5) です。
もちろん、実際には七対子があるので、本当の最大シャンテン数は 6 シャンテンになります。</p><p>あとは、8 シャンテンを基準にして、手牌にどのような形が含まれていればシャンテン数が減るのかを調べていけば OK です。</p><h2 id=ターツまたはトイツができると-1-歩前進>ターツまたはトイツができると 1 歩前進</h2><span class=xMjCenter>1m2m9m-1s5s9s-1p4p8p-1z2z3z-7z7z</span><p>上記のように、ターツ ( <span class=xMj>1m2m</span>
) やトイツ ( <span class=xMj>7z7z</span>
) ができると聴牌に向かって 1 歩前進します。
このように 2 枚で構成されるターツあるいはトイツのことを <strong>ペア</strong> と呼ぶことにします（ペアの例: <span class=xMj>1m2m</span>
、<span class=xMj>3s4s</span>
、<span class=xMj>7p9p</span>
、<span class=xMj>4z4z</span>
）。
ペア 1 組ごとにシャンテン数は 1 つ減るので、（ペアだけを考慮した）シャンテン数は次のように計算できます。</p><div style=text-align:center;font-weight:700>8 - ペア数</div><p>ただし、ペアとしてカウントできるのは、最大 5 つまでです。
なぜなら、アガリ形のブロック数は最大 5 つだからです。
あと、<span class=xMj>5p5p</span>
+ <span class=xMj>5p5p</span>
のような形で、同一牌で 2 つのペアとカウントすることはできないことに注意してください。</p><h2 id=メンツができると-2-歩前進>メンツができると 2 歩前進</h2><span class=xMjCenter>1m2m3m-1s5s9s-1p4p8p-1z2z3z-5z7z</span><p>ターツが <span class=xMj>1m2m3m</span>
のようなメンツに変化すると、さらに 1 歩前進するので、メンツ数を考慮したシャンテン数は次のように計算できます。</p><div style=text-align:center;font-weight:700>8 - (メンツ数 x 2) - ペア数</div><p>ここでは、メンツを 2 歩前進するものと数えているので、メンツになった部分はペアのカウントを減らしてください。
メンツとペアを、それぞれ 1 つのブロックとしてカウントするのであれば、次のような計算式でも大丈夫です。</p><div style=text-align:center;font-weight:700>8 - メンツ数 - ブロック数</div><p>「ブロック数 = メンツ数 + ペア数」と展開すると、前の式とまったく同じです。</p><h2 id=メンツ数による制約>メンツ数による制約</h2><p>ターツやトイツ（これらをペアと呼んでいます）がたくさんあっても、最終的なアガリ形は 4 メンツ + 1 雀頭になるので、やみくもにペアの数をカウントしてシャンテン数を減少させるわけにはいきません。
例えば、4 メンツ完成しているときは、残りのブロックは雀頭（トイツ）ででなければいけないので、ターツは採用できません。
3 メンツ完成しているときは、ターツは 1 つまでしか採用できません。ターツは雀頭にはなり得ないからです。
完成メンツ数に応じて、カウントできる（採用可能な）ターツの最大数は次のように変化します。</p><table><thead><tr><th style=text-align:center>完成メンツ数</th><th style=text-align:center>カウントできるターツ数</th></tr></thead><tbody><tr><td style=text-align:center>4</td><td style=text-align:center>0</td></tr><tr><td style=text-align:center>3</td><td style=text-align:center>1</td></tr><tr><td style=text-align:center>2</td><td style=text-align:center>2</td></tr><tr><td style=text-align:center>1</td><td style=text-align:center>3</td></tr><tr><td style=text-align:center>0</td><td style=text-align:center>4</td></tr></tbody></table><p>つまり、<strong>カウントできるターツの最大数は「4 - 完成メンツ数」</strong> です。</p><p>さらに、完成形は 5 ブロックなので、メンツとペアを合わせて 5 を超えてカウントすることはできません。
つまり、<strong>カウントできるトイツの最大数は「5 - 完成メンツ数 - ターツ数」</strong> です。
ただし、このターツ数は、上記の補正を行ったあとのターツ数です。</p><p>例題として、次のような形を考えてみます（ここではツモる前の 13 枚で考えてみます）。</p><span class=xMjCenter>1m1m1m2s3s7s8s1p3p5p7p1z1z</span><p>メンツが 1 つ、ターツが 4 つ、トイツが 1 つありますが、実際に採用できるターツ最大数とトイツ最大数は次のように計算します。</p><ul><li>ターツ最大数 = 4 - 完成メンツ数 = 4 - 1 = <strong>3</strong><ul><li>よって、採用するターツ数は 3 となる（1 つのターツは無駄になる）</li></ul></li><li>トイツ最大数 = 5 - 完成メンツ数 - 採用ターツ数 = 5 - 1 - 3 = <strong>1</strong><ul><li>よって、採用するトイツ数は 1 となる</li></ul></li></ul><p>最終的に、シャンテン数は、8 - (1 x 2) - 3 - 1 = 2 と計算できます。
あと 2 枚で聴牌するリャンシャンテンですね。</p><h2 id=メンツターツトイツを数える>メンツ、ターツ、トイツを数える</h2><p>シャンテン数の計算式を定義できたので、あとは、手牌の中のメンツとペア（ターツ or トイツ）の数が分かればシャンテン数を計算できます。
手牌の中からメンツあるいはペアを抽出するときの形は、たかだか次のようなパターンしか存在しないので、このパターンの組み合わせを総当たりで抽出してみて、一番シャンテン数が少なくなったものが求めたいシャンテン数になるはずです。</p><ul><li>ブロック抽出パターン<ol><li>メンツ（刻子）&mldr; <span class=xMj>1p1p1p</span></li><li>メンツ（順子）&mldr; <span class=xMj>1p2p3p</span></li><li>対子 &mldr; <span class=xMj>1p1p</span></li><li>ターツ（連続形）&mldr; <span class=xMj>1p2p</span></li><li>ターツ（嵌張形）&mldr; <span class=xMj>1p3p</span></li></ol></li></ul><p>シンプルに実装するなら、初歩的なバックトラックを使って全探索してしまえば OK です。
最適化手法としては、</p><ul><li>完全な孤立牌を最初に削除してから処理する</li><li>同一色の手牌パターンから、ブロック構成を求めるテーブルを用意しておく</li></ul><p>などがあるようですが、何百万回も実行するようなシミュレーションでなければ、単純なバックトラックだけでも速度的には問題なさそうです。</p><p>ソースコードは後ほど公開予定です。</p><meta itemprop=author content="まく"><span itemprop=publisher itemscope itemtype=https://schema.org/Organization><meta itemprop=name content="まく"></span></div><div style=text-align:right><div id=codoc-entry-4gYwTntzzw class=codoc-entries data-without-body=1 data-support-button-text="（っ'-')╮シュッ=͟͟͞͞ 💵" data-show-like=0 data-show-about-codoc=0 data-show-powered-by=0 data-support-message=まくに投げ銭できるよ></div></div><div class=xArticle_up><a href=../../p/nythxwz/><span class=xArticle_up_label>コラム・雑記</span><br>へ戻る</a></div><aside><div class=xPrevNextLink><div class=xPrevNextLink_next><a href=../../p/3p3eq3e/>人間ドックの日に打ったら</a></div></div></aside></article><script async src=//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script>
<ins class=adsbygoogle style=display:block;text-align:center data-ad-layout=in-article data-ad-format=fluid data-ad-client=ca-pub-6317852277883092 data-ad-slot=8636867067></ins>
<script>(adsbygoogle=window.adsbygoogle||[]).push({})</script></main></div><aside><div class=xBreadcrumb><span class=xBreadcrumb_item><a href=../../>&#x1F3E0;</a></span>
<span class=xBreadcrumb_item><a href=../../p/nythxwz/>コラム・雑記</a></span>
<span class=xBreadcrumb_item>麻雀のシャンテン数を数えるアルゴリズム</span></div></aside><div id=xSiteFooter><a href=../../>まくまく麻雀ノート</a></div><div id=xSiteFooter2><a href=../../sitemap/>サイトマップ</a> ｜
<a tatget=_blank href=https://forms.gle/xdUszEv4f5CEqH947>まくへのメッセージ</a></div></div><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"まくまく麻雀ノート","item":"https://mj.maku.blog/"},{"@type":"ListItem","position":2,"name":"コラム・雑記","item":"https://mj.maku.blog/p/nythxwz/"},{"@type":"ListItem","position":3,"name":"麻雀のシャンテン数を数えるアルゴリズム","item":"https://mj.maku.blog/p/5jrczda/"}]}</script></body></html>